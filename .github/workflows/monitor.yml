name: é‡‘å·¥ç å¯¶ç›£æ§-ä¿®å¾©ç‰ˆ

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  monitor:
    runs-on: ubuntu-latest
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4
    
    - name: å¼·åˆ¶æª¢æŸ¥æ‰€æœ‰æª”æ¡ˆ
      run: |
        echo "ğŸ” ç•¶å‰å·¥ä½œç›®éŒ„:"
        pwd
        echo "ğŸ“ æ ¹ç›®éŒ„æª”æ¡ˆ:"
        ls -la
        echo "ğŸ“ å°‹æ‰¾ requirements.txt:"
        find . -regex '.*requirements.txt$'
        echo "ğŸ“„ requirements.txt å…§å®¹:"
        cat ./requirements.txt 2>/dev/null || echo "âŒ ç„¡æ³•è®€å– requirements.txt"
    
    - name: è¨­ç½® Python ç’°å¢ƒ
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: æ‰‹å‹•å®‰è£å¥—ä»¶
      run: |
        echo "ğŸ“¦ ç›´æ¥å®‰è£å¥—ä»¶ï¼Œä¸ä¾è³´ requirements.txt"
        pip install requests==2.31.0
        pip install cloudscraper==1.2.71
        pip install python-dateutil==2.8.2
        echo "âœ… å¥—ä»¶å®‰è£å®Œæˆ"
    
    - name: åŸ·è¡Œç›£æ§ç¨‹å¼
      run: |
        cd src
        python monitor.py
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
    
    - name: æäº¤çµæœ
      if: success()
      run: |
        git config --l
